<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-caching/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Caching with Cube | WDC 2025 Cube Semantic Layer Workshop</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://cube-js.github.io/cube-workshop/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://cube-js.github.io/cube-workshop/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://cube-js.github.io/cube-workshop/docs/caching"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Caching with Cube | WDC 2025 Cube Semantic Layer Workshop"><meta data-rh="true" name="description" content="One of Cube&#x27;s most powerful features is its sophisticated caching system that can dramatically improve query performance and provide higher concurrency for analytical workloads. Instead of hitting your database every time, Cube can serve results from optimized caches that are orders of magnitude faster."><meta data-rh="true" property="og:description" content="One of Cube&#x27;s most powerful features is its sophisticated caching system that can dramatically improve query performance and provide higher concurrency for analytical workloads. Instead of hitting your database every time, Cube can serve results from optimized caches that are orders of magnitude faster."><link data-rh="true" rel="icon" href="/cube-workshop/img/cube-icon.svg"><link data-rh="true" rel="canonical" href="https://cube-js.github.io/cube-workshop/docs/caching"><link data-rh="true" rel="alternate" href="https://cube-js.github.io/cube-workshop/docs/caching" hreflang="en"><link data-rh="true" rel="alternate" href="https://cube-js.github.io/cube-workshop/docs/caching" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Caching with Cube","item":"https://cube-js.github.io/cube-workshop/docs/caching/"}]}</script><link rel="stylesheet" href="/cube-workshop/assets/css/styles.e7fe3a88.css">
<script src="/cube-workshop/assets/js/runtime~main.ae6732e1.js" defer="defer"></script>
<script src="/cube-workshop/assets/js/main.cee8d007.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/cube-workshop/img/cube-logo.svg"><link rel="preload" as="image" href="/cube-workshop/img/cube-logo-dark.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/cube-workshop/"><div class="navbar__logo"><img src="/cube-workshop/img/cube-logo.svg" alt="Cube Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/cube-workshop/img/cube-logo-dark.svg" alt="Cube Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">WDC 2025 Cube Semantic Layer Workshop</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cube-workshop/docs/intro">Workshop</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/cube-js/cube-workshop" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><a href="https://cube.dev" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Cube.dev<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/cube-workshop/docs/intro">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/cube-workshop/docs/setup">Workshop Setup</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/cube-workshop/docs/data-modeling">Workshop Exercises</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cube-workshop/docs/data-modeling">Data Modeling with Cube</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cube-workshop/docs/access-control">Access Control with Cube</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/cube-workshop/docs/caching">Caching with Cube</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cube-workshop/docs/apis">APIs: Multiple Ways to Access Data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cube-workshop/docs/react-app">Building a React Dashboard</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cube-workshop/docs/d3-analytics">D3 Agentic Analytics</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/cube-workshop/docs/resources">Resources &amp; Next Steps</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/cube-workshop/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Workshop Exercises</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Caching with Cube</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Caching with Cube</h1></header>
<p>One of Cube&#x27;s most powerful features is its sophisticated caching system that can <strong>dramatically improve query performance</strong> and provide <strong>higher concurrency</strong> for analytical workloads. Instead of hitting your database every time, Cube can serve results from optimized caches that are orders of magnitude faster.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-caching-matters">Why Caching Matters<a href="#why-caching-matters" class="hash-link" aria-label="Direct link to Why Caching Matters" title="Direct link to Why Caching Matters">​</a></h2>
<p>In analytics, you often face the challenge of querying large datasets repeatedly. Without caching:</p>
<ul>
<li><strong>Slow queries</strong> - Complex aggregations across millions or billions of rows take time</li>
<li><strong>Database load</strong> - Multiple users running similar queries strain your data warehouse</li>
<li><strong>Poor user experience</strong> - Dashboard users wait seconds or minutes for results</li>
<li><strong>High costs</strong> - Cloud data warehouses charge for compute time</li>
</ul>
<p>Cube&#x27;s caching solves these problems by creating <strong>pre-computed, aggregated data</strong> that can answer queries in milliseconds rather than seconds.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="cubes-two-level-caching-system">Cube&#x27;s Two-Level Caching System<a href="#cubes-two-level-caching-system" class="hash-link" aria-label="Direct link to Cube&#x27;s Two-Level Caching System" title="Direct link to Cube&#x27;s Two-Level Caching System">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-in-memory-cache-automatic">1. In-Memory Cache (Automatic)<a href="#1-in-memory-cache-automatic" class="hash-link" aria-label="Direct link to 1. In-Memory Cache (Automatic)" title="Direct link to 1. In-Memory Cache (Automatic)">​</a></h3>
<p>Cube automatically caches query results in memory using the generated SQL as the cache key. This happens transparently - no configuration required.</p>
<ul>
<li>✅ <strong>Automatic</strong> - Works out of the box</li>
<li>✅ <strong>Fast</strong> - Serves repeated queries instantly</li>
<li>✅ <strong>Smart invalidation</strong> - Uses refresh keys to detect when data changes</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-pre-aggregations-configurable">2. Pre-Aggregations (Configurable)<a href="#2-pre-aggregations-configurable" class="hash-link" aria-label="Direct link to 2. Pre-Aggregations (Configurable)" title="Direct link to 2. Pre-Aggregations (Configurable)">​</a></h3>
<p>Pre-aggregations are <strong>condensed, optimized data versions</strong> that you configure in your data model. They can reduce dataset size by <strong>several orders of magnitude</strong>.</p>
<ul>
<li>🎯 <strong>Targeted</strong> - You choose what to cache</li>
<li>🚀 <strong>Extreme performance</strong> - Millisecond response times</li>
<li>🔄 <strong>Background refresh</strong> - Updates happen behind the scenes</li>
<li>🛡️ <strong>Security-aware</strong> - Respects all access control rules</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="understanding-additive-vs-non-additive-measures">Understanding Additive vs Non-Additive Measures<a href="#understanding-additive-vs-non-additive-measures" class="hash-link" aria-label="Direct link to Understanding Additive vs Non-Additive Measures" title="Direct link to Understanding Additive vs Non-Additive Measures">​</a></h2>
<p>Before diving into pre-aggregations, it&#x27;s crucial to understand which measures work well for caching:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-additive-measures-cache-friendly">✅ Additive Measures (Cache-Friendly)<a href="#-additive-measures-cache-friendly" class="hash-link" aria-label="Direct link to ✅ Additive Measures (Cache-Friendly)" title="Direct link to ✅ Additive Measures (Cache-Friendly)">​</a></h3>
<p>These measures can be safely aggregated and combined:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">measures</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Perfect for pre-aggregations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> total_sales</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> revenue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sum</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> order_count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> active_users</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> user_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> count_distinct_approx</span><br></span></code></pre></div></div>
<p><strong>Why they work:</strong> You can sum sums, add counts, and roll up totals across time periods and dimensions.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-non-additive-measures-cache-challenging">❌ Non-Additive Measures (Cache-Challenging)<a href="#-non-additive-measures-cache-challenging" class="hash-link" aria-label="Direct link to ❌ Non-Additive Measures (Cache-Challenging)" title="Direct link to ❌ Non-Additive Measures (Cache-Challenging)">​</a></h3>
<p>These measures don&#x27;t combine well in pre-aggregations.  They can still be pre-aggregated, but the aggregate will only be used if the query matches the exact grain of the pre-aggregation (includes exactly the same dimensions):</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">measures</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Problematic for basic pre-aggregations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># averages</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> average_order_value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{order_value}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> average</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># distinct counts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> distinct_customers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> customer_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> count_distinct</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ratios</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> conversion_rate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{orders} / {visitors} * 100&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> number</span><br></span></code></pre></div></div>
<p><strong>Why they&#x27;re tricky:</strong> You can&#x27;t average averages, ratios don&#x27;t sum correctly, and distinct counts need special handling.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-making-non-additive-measures-cache-friendly">💡 Making Non-Additive Measures Cache-Friendly<a href="#-making-non-additive-measures-cache-friendly" class="hash-link" aria-label="Direct link to 💡 Making Non-Additive Measures Cache-Friendly" title="Direct link to 💡 Making Non-Additive Measures Cache-Friendly">​</a></h3>
<p>The solution? Store the <strong>building blocks</strong> instead:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Instead of storing average_order_value directly,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># store the components and calculate on-the-fly</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">measures</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> total_sales</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> revenue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sum</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> order_count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> average_order_value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{CUBE.total_sales} / {CUBE.order_count}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># This calculates correctly from cached components!</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pre-aggregations-in-action">Pre-Aggregations in Action<a href="#pre-aggregations-in-action" class="hash-link" aria-label="Direct link to Pre-Aggregations in Action" title="Direct link to Pre-Aggregations in Action">​</a></h2>
<p>Let&#x27;s add some pre-aggregations to our TPC-H model to see the performance benefits.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-are-pre-aggregations">What Are Pre-Aggregations?<a href="#what-are-pre-aggregations" class="hash-link" aria-label="Direct link to What Are Pre-Aggregations?" title="Direct link to What Are Pre-Aggregations?">​</a></h3>
<p>Think of pre-aggregations as <strong>pre-computed summary tables</strong> that Cube creates and maintains for you, generally:</p>
<ul>
<li><strong>Without pre-aggregations</strong>: Every query runs against your data warehouse</li>
<li><strong>With pre-aggregations</strong>: Queries hit much smaller, pre-computed roll-ups</li>
</ul>
<p><strong>Key Components of a Pre-Aggregation:</strong></p>
<ul>
<li><strong>Measures</strong>: The aggregates you want to calculate (revenue, count, etc.)</li>
<li><strong>Dimensions</strong>: How you want to group or filter the measures (by region, product type, etc.)</li>
<li><strong>Time dimension</strong>: The date/time field for time-based grouping</li>
<li><strong>Granularity</strong>: The time bucket size (hour, day, week, month) - trunctates the time dimension to this level</li>
<li><strong>Refresh key</strong>: How often to rebuild the pre-aggregation with fresh data</li>
</ul>
<p>Pre-aggregations are aggregate-aware, meaning they can be used to answer queries that match their defined measures and dimensions <strong>or any subset of fields or higher date rollup</strong>. If a query includes additional dimensions not in the pre-aggregation, it will fall back to a live query against the data warehouse.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Development Mode Reminder</div><div class="admonitionContent_BuS1"><p>Before adding pre-aggregations to your data model, ensure you&#x27;re in <strong>Development Mode</strong>:</p><ol>
<li>Navigate to the <strong>Data Model</strong> page</li>
<li>Click <strong>&quot;Dev Mode&quot;</strong> (top of the interface)</li>
<li>Continue with your existing development branch from the access control module</li>
</ol><p>This ensures your caching optimizations won&#x27;t affect production until you&#x27;re ready to deploy them.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="exercise-1-basic-sales-pre-aggregation">Exercise 1: Basic Sales Pre-Aggregation<a href="#exercise-1-basic-sales-pre-aggregation" class="hash-link" aria-label="Direct link to Exercise 1: Basic Sales Pre-Aggregation" title="Direct link to Exercise 1: Basic Sales Pre-Aggregation">​</a></h3>
<p>Add this pre-aggregation to your <code>line_items.yml</code> cube:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">/model/cubes/line_items.yml</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">joins</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> orders</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">relationship</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> many_to_one</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{CUBE}.l_orderkey = {orders}.o_orderkey&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> parts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">relationship</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> many_to_one</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{CUBE}.l_partkey = {parts}.p_partkey&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> suppliers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">relationship</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> many_to_one</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{CUBE}.l_suppkey = {suppliers}.s_suppkey&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">pre_aggregations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sales_by_month</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">measures</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> total_sales_amount</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> total_quantity</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> count</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">dimensions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> customer_regions.name</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> customer_regions.region_key</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> customers.name</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> customers.customer_key</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">time_dimension</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ship_date</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">granularity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> month</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">refresh_key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">every</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1 day&quot;</span><br></span></code></pre></div></div>
<p><strong>What this does:</strong></p>
<ul>
<li>Pre-calculates monthly sales totals</li>
<li>Updates every day to keep data fresh</li>
<li>Dramatically speeds up queries grouped by month</li>
<li>Contains the dimensions needed for regional and customer row-level security (so our directors and sales reps can hit the cache)</li>
</ul>
<p>Now let&#x27;s head over to the Pre-Aggregations tab in Cube Cloud and compile our changes.  This will create the pre-aggregation table in Cube Store.</p>
<ol>
<li>Click the <strong>Pre-Aggregations</strong> tab in Cube Cloud</li>
<li>Click <strong>line_items sales_by_month</strong> text to open the pre-aggregation details</li>
<li>Click <strong>Build All</strong> to create the pre-aggregation</li>
<li>Wait for the build to complete (should take less than a minute)</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Pre-aggregation build complete" src="/cube-workshop/assets/images/pre-agg-build-complete-f1f89a34e66d77d4e84fd66a3303ade1.png" width="3016" height="1164" class="img_ev3q"></p>
<p>When that&#x27;s done, you can test the performance improvement:</p>
<ol>
<li>Go to the <strong>Playground</strong> tab</li>
<li>Run a query on the <strong>sales</strong> view with:<!-- -->
<ul>
<li>Measures: <code>total_sales_amount</code>, <code>total_quantity</code></li>
<li>Time: <code>ship_date</code> by <code>month</code></li>
</ul>
</li>
<li>Run with each of our 3 test user types (admin, director, sales rep) in the security context</li>
</ol>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;user_id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;admin@tpch.com&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;user_id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;director_na@tpch.com&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;user_id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;sarah_jones@tpch.com&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<ol start="4">
<li>Note the execution time (in the top-right) after adding the pre-aggregation has dropped to sub-second!  You can also see the <strong>cache indicator</strong>  showing that the query hit the pre-aggregation cache (yellow lightning bolt).  Check the <strong>Generated SQL</strong> tab to see the SQL that was run against the pre-aggregation table.</li>
</ol>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>If you ever want to see if a query will hit a pre-aggregation, you can set up your query (fields, filters, sort, etc) in the playground and just click <strong>Generated SQL</strong> - if the source looks like <code>SELECT ... FROM prod_pre_aggregations... </code> you&#x27;re hitting a pre-agg - no need to hit the <strong>Run Query</strong> button to find out.</p></div></div>
<ol start="5">
<li><strong>Test dimension coverage</strong>:<!-- -->
<ul>
<li>Add <code>region</code> to the query → Check <strong>Generated SQL</strong> → Should still hit pre-aggregation (because we included <code>customer_regions.name</code>)</li>
<li>Add <code>nation</code> to the query → Check <strong>Generated SQL</strong> → No longer hits pre-aggregation (because we didn&#x27;t include nation)</li>
</ul>
</li>
</ol>
<p><strong>Key Learning</strong>: Pre-aggregations only accelerate queries that use <strong>measures and dimensions you defined, or a subset</strong>. If a query needs additional dimensions, it falls back to raw data.</p>
<p><strong>Why This Matters</strong>: You need to carefully choose which dimensions to include based on how your dashboards will actually be used. Include too few → fewer cache hits. Include too many → larger, slower pre-aggregations.  There&#x27;s a balance to strike based on your business needs.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="exercise-2-executive-kpi-dashboard-pre-aggregation">Exercise 2: Executive KPI Dashboard Pre-Aggregation<a href="#exercise-2-executive-kpi-dashboard-pre-aggregation" class="hash-link" aria-label="Direct link to Exercise 2: Executive KPI Dashboard Pre-Aggregation" title="Direct link to Exercise 2: Executive KPI Dashboard Pre-Aggregation">​</a></h3>
<p>Now let&#x27;s create a high-level pre-aggregation perfect for an executive dashboard showing key business metrics.</p>
<p><strong>Planning Your Pre-Aggregation:</strong>
Before writing the YAML, think about:</p>
<ul>
<li><strong>Who will use this?</strong> → Executives need high-level trends, not detailed drill-downs</li>
<li><strong>What questions will they ask?</strong> → &quot;How are sales trending by brand?&quot; &quot;Which regions underperform?&quot;</li>
<li><strong>How often do they check?</strong> → Weekly reviews, so weekly granularity makes sense</li>
<li><strong>What filtering do they need?</strong> → By brand, priority, region (plus security filtering)</li>
</ul>
<p>Add the <code>executive_kpis</code> pre-agg to your <code>line_items.yml</code> cube:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">/model/cubes/line_items.yml</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">pre_aggregations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sales_by_month</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">measures</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> total_sales_amount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> total_quantity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">dimensions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> customer_regions.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> customer_regions.region_key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> customers.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> customers.customer_key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">time_dimension</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ship_date</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">granularity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> month</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">refresh_key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">every</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1 day&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> executive_kpis</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">measures</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> total_sales_amount</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> total_discount</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">dimensions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> customer_regions.name</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> customer_regions.region_key</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> customers.customer_key</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> parts.brand</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> orders.priority</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">time_dimension</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ship_date</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">granularity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> week</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">refresh_key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">every</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;4 hour&quot;</span><br></span></code></pre></div></div>
<p><strong>What this pre-aggregation enables:</strong></p>
<ul>
<li>📊 <strong>Weekly Revenue Trends</strong> - Perfect for executive dashboards</li>
<li>🏷️ <strong>Brand Performance Analysis</strong> - Which brands drive revenue</li>
<li>🚨 <strong>Priority Order Tracking</strong> - Monitor urgent vs regular orders</li>
<li>💰 <strong>Discount Impact Analysis</strong> - Track margin erosion</li>
<li>🔒 <strong>Security-Ready</strong> - Includes dimensions for row-level filtering</li>
</ul>
<p><strong>Testing Your Pre-Aggregation:</strong></p>
<ol>
<li><strong>Save your changes</strong> and navigate to the Pre-Aggregations tab</li>
<li><strong>Build the pre-aggregation</strong> by clicking <strong>line_items executive_kpis</strong> then &quot;Build All&quot;</li>
<li><strong>Test in Playground</strong> with a query using the <code>sales</code> view like:<!-- -->
<ul>
<li>Measures: <code>total_sales_amount</code>, <code>discount_rate</code></li>
<li>Dimensions: <code>parts_brand</code></li>
</ul>
</li>
<li><strong>Check Generated SQL</strong> - Look for <code>prod_pre_aggregations</code> in the FROM clause to confirm cache hit</li>
</ol>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p><code>discount_rate</code> is a non-additive measure, and it is not in our pre-aggregation - however, it can be calculated on-the-fly from the pre-aggregated <code>total_sales_amount</code> and <code>total_discount</code> measures.</p><p><img decoding="async" loading="lazy" alt="Discount Rate Calculated from Pre-Aggregation" src="/cube-workshop/assets/images/discount_rate_preagg-5f1032661674172e097074b87f74a1c1.png" width="1511" height="649" class="img_ev3q"></p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="exercise-3-customer-behavior-pre-aggregation">Exercise 3: Customer Behavior Pre-Aggregation<a href="#exercise-3-customer-behavior-pre-aggregation" class="hash-link" aria-label="Direct link to Exercise 3: Customer Behavior Pre-Aggregation" title="Direct link to Exercise 3: Customer Behavior Pre-Aggregation">​</a></h3>
<p><strong>Notice</strong>: This pre-aggregation goes in the <code>orders.yml</code> cube, not <code>line_items.yml</code>.</p>
<p><strong>Why?</strong> Because we&#x27;re analyzing <strong>order-level behavior</strong> (how many orders, average order value), not line-item details. The grain of analysis determines which cube gets the pre-aggregation.</p>
<p><strong>Different Cube, Different Insights:</strong></p>
<ul>
<li><code>line_items</code> cube → Product sales details, return rates, shipping analysis</li>
<li><code>orders</code> cube → Customer purchasing patterns, order frequency, order sizes</li>
</ul>
<p>Add this to your <code>orders.yml</code> cube:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">/model/cubes/orders.yml</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">joins</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> customers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">relationship</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> many_to_one</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{CUBE}.o_custkey = {customers}.c_custkey&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> line_items</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">relationship</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> one_to_many</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{CUBE}.o_orderkey = {line_items}.l_orderkey&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">pre_aggregations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> customer_behavior</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">measures</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> count</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> total_revenue</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">dimensions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> customer_regions.name</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> customer_regions.region_key</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> customers.customer_key</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> customers.segment</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> status</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> order_size_category</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">time_dimension</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> order_date</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">granularity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> day</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">refresh_key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">every</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;8 hour&quot;</span><br></span></code></pre></div></div>
<p><strong>Save</strong> your changes to the cube.</p>
<p><strong>Dashboard possibilities:</strong></p>
<ul>
<li>📈 <strong>Customer Segment Performance</strong> - Compare segments over time</li>
<li>📦 <strong>Order Size Distribution</strong> - Understand purchase patterns</li>
<li>✅ <strong>Order Status Monitoring</strong> - Track fulfillment metrics</li>
<li>👥 <strong>Customer Value Analysis</strong> - Identify high-value customers</li>
</ul>
<p><strong>Create the Customer Behavior View:</strong></p>
<p>Before testing, create a view optimized for customer behavior analysis. Create a new file <code>customer_behavior.yml</code> in your <code>model/views</code> folder:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">/model/views/customer_behavior.yml</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">views</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> customer_behavior</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">description</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Customer behavior analytics optimized for order-level analysis&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">public</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">cubes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Base cube - orders (order-level analysis)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">join_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> orders</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">includes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> total_revenue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> average_order_value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> order_date</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> priority</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> order_size_category</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Customer information</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">join_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> orders.customers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">prefix</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">includes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> segment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> account_balance</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> customer_key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">excludes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> phone</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> address</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> comment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Geographic context</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">join_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> orders.customers.customer_nations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">includes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">alias</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">join_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> orders.customers.customer_nations.customer_regions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">includes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">alias</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> region</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> region_key</span><br></span></code></pre></div></div>
<p><strong>Testing Your Pre-Aggregation:</strong></p>
<ol>
<li><strong>Save your changes</strong> to the new view</li>
<li>Build the pre-aggregation (<strong>Pre-Aggregations</strong> tab, click <code>orders customer_behavior</code>, then &quot;Build All&quot;)</li>
<li><strong>Test in Playground</strong> using the <code>customer_behavior</code> view with:<!-- -->
<ul>
<li>Measures: <code>count</code>, <code>total_revenue</code></li>
<li>Dimensions: <code>customers_segment</code>, <code>order_size_category</code></li>
<li>Time: <code>order_date</code> by <code>month</code></li>
</ul>
</li>
<li><strong>Verify cache usage</strong> by checking the Generated SQL tab.  Note that the pre-aggregation is at the <code>day</code> granularity, but the query is rolled up to <code>month</code> - Cube will automatically roll up the pre-aggregation to the requested granularity.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="understanding-your-pre-aggregation-strategy">Understanding Your Pre-Aggregation Strategy<a href="#understanding-your-pre-aggregation-strategy" class="hash-link" aria-label="Direct link to Understanding Your Pre-Aggregation Strategy" title="Direct link to Understanding Your Pre-Aggregation Strategy">​</a></h2>
<p>You&#x27;ve now created <strong>three different pre-aggregations</strong> for different use cases:</p>
<table><thead><tr><th>Pre-Aggregation</th><th>Cube</th><th>Granularity</th><th>Purpose</th><th>Users</th></tr></thead><tbody><tr><td><code>sales_by_month</code></td><td>line_items</td><td>month</td><td>Basic sales reporting</td><td>All users</td></tr><tr><td><code>executive_kpis</code></td><td>line_items</td><td>week</td><td>Executive dashboards</td><td>Leadership</td></tr><tr><td><code>customer_behavior</code></td><td>orders</td><td>day</td><td>Customer analysis</td><td>All users</td></tr></tbody></table>
<p><strong>Key Patterns You&#x27;ve Learned:</strong></p>
<ol>
<li><strong>Match granularity to business need</strong>: Daily for operations, weekly for executives</li>
<li><strong>Choose the right cube</strong>: Line items for product/sales details, orders for customer behavior</li>
<li><strong>Include security dimensions</strong>: All pre-aggregations work with row-level security</li>
<li><strong>Plan for specific dashboards</strong>: Each pre-aggregation serves real business questions</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="performance-optimization-strategies">Performance Optimization Strategies<a href="#performance-optimization-strategies" class="hash-link" aria-label="Direct link to Performance Optimization Strategies" title="Direct link to Performance Optimization Strategies">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-granularity-matters">1. Granularity Matters<a href="#1-granularity-matters" class="hash-link" aria-label="Direct link to 1. Granularity Matters" title="Direct link to 1. Granularity Matters">​</a></h3>
<p>Choose the granularity based on how your data will be queried.  You can create multiple pre-aggregations at different granularities to serve different use cases, understanding that the higher the granularity (e.g., month vs. day, category vs. item), the smaller and more performant the pre-aggregation will be.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-dimension-selection">2. Dimension Selection<a href="#2-dimension-selection" class="hash-link" aria-label="Direct link to 2. Dimension Selection" title="Direct link to 2. Dimension Selection">​</a></h3>
<p>Include only dimensions that:</p>
<ul>
<li>Are used in dashboard filters or grouping</li>
<li>Are needed for row-level security</li>
<li>Provide business value</li>
</ul>
<p><strong>Avoid:</strong> Including all possible dimensions &quot;just in case&quot; - that&#x27;s what the fall back to a live query is for.  Pre-aggregations are generally focused on the most common queries.  Occasionally, you may need to create a pre-aggregation that includes low-level or even primary key-level grain for specific use cases, but this should be the exception, not the rule.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-measure-additivity">3. Measure Additivity<a href="#3-measure-additivity" class="hash-link" aria-label="Direct link to 3. Measure Additivity" title="Direct link to 3. Measure Additivity">​</a></h3>
<p>Structure your measures for maximum reusability:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># ✅ Good - Additive components</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">measures</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gross_revenue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sum</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{CUBE}.extended_price&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> discount_amount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sum</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{CUBE}.extended_price * {CUBE}.discount&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> net_revenue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{CUBE.gross_revenue} - {CUBE.discount_amount}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ❌ Avoid - Non-additive in pre-aggregation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">measures where possible</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> avg_discount_pct</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> avg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> discount</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-refresh-strategy-based-on-business-needs">4. Refresh Strategy Based on Business Needs<a href="#4-refresh-strategy-based-on-business-needs" class="hash-link" aria-label="Direct link to 4. Refresh Strategy Based on Business Needs" title="Direct link to 4. Refresh Strategy Based on Business Needs">​</a></h3>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># &quot;Real-time&quot; operational metrics</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">refresh_key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">every</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;10 minute&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Intra-day business metrics</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">refresh_key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">every</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1 hour&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Historical analysis</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">refresh_key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">every</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1 day&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="visual-performance-indicator">Visual Performance Indicator<a href="#visual-performance-indicator" class="hash-link" aria-label="Direct link to Visual Performance Indicator" title="Direct link to Visual Performance Indicator">​</a></h3>
<p>In Cube Cloud&#x27;s Playground, you&#x27;ll see a <strong>cache indicator</strong> showing whether your query hit:</p>
<p><img decoding="async" loading="lazy" alt="Cache performance indicators" src="/cube-workshop/assets/images/cache-indicator-534b88a9375b4483e48c415d51c869c4.png" width="688" height="296" class="img_ev3q"></p>
<p>You can also see these indicators if you review the <strong>Query History</strong> tab where you can see all the queries against your data model from all APIs.  The playground queryies show up as REST. Clicking on a query will show you the details, including the <strong>Generated SQL</strong>, <strong>Security Context</strong>, and <strong>Performance Graphs</strong>.</p>
<p><img decoding="async" loading="lazy" alt="Query History with Cache Indicators" src="/cube-workshop/assets/images/query-history-ad0412d5b3b1d97b4570cb11b67077c1.png" width="3020" height="1516" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="building-and-monitoring-pre-aggregations">Building and Monitoring Pre-Aggregations<a href="#building-and-monitoring-pre-aggregations" class="hash-link" aria-label="Direct link to Building and Monitoring Pre-Aggregations" title="Direct link to Building and Monitoring Pre-Aggregations">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="build-strategy">Build Strategy<a href="#build-strategy" class="hash-link" aria-label="Direct link to Build Strategy" title="Direct link to Build Strategy">​</a></h3>
<p>When adding pre-aggregations to your data model:</p>
<ol>
<li><strong>Start Small</strong> - Add one pre-aggregation at a time</li>
<li><strong>Monitor Build Times</strong> - Check the Pre-Aggregations tab</li>
<li><strong>Verify Usage</strong> - Ensure queries are hitting the cache</li>
<li><strong>Iterate</strong> - Adjust dimensions and granularity based on usage, add indexes and partitions as needed</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="common-pitfalls-to-avoid">Common Pitfalls to Avoid<a href="#common-pitfalls-to-avoid" class="hash-link" aria-label="Direct link to Common Pitfalls to Avoid" title="Direct link to Common Pitfalls to Avoid">​</a></h3>
<p>❌ <strong>Too Many Dimensions</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Bad - Creates massive pre-aggregation that&#x27;s slow to build and query</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">dimensions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">customer_key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> product_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> order_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> line_number</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sku</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Result: Millions of combinations, slow builds, little cache benefit</span><br></span></code></pre></div></div>
<p>✅ <strong>Strategic Dimensions</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Good - Focused on actual dashboard filtering and grouping needs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">dimensions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">region</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> segment</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> product_type</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> priority</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Result: Manageable size, fast builds, excellent cache hit rates - especially for your initial dashboard page loads</span><br></span></code></pre></div></div>
<p>❌ <strong>Too Fine Granularity</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Bad for long-term historical data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">granularity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> minute  </span><span class="token comment" style="color:#999988;font-style:italic"># 2 years = 1,051,200 time periods per dimension combo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Result: Enormous pre-aggregations</span><br></span></code></pre></div></div>
<p>✅ <strong>Appropriate Granularity</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Good - Match your dashboard&#x27;s actual time grouping needs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">granularity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> day    </span><span class="token comment" style="color:#999988;font-style:italic"># For operational dashboards (730 periods/2 years)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">granularity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> week   </span><span class="token comment" style="color:#999988;font-style:italic"># For executive trending (104 periods/2 years)  </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">granularity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> month  </span><span class="token comment" style="color:#999988;font-style:italic"># For historical analysis (24 periods/2 years)</span><br></span></code></pre></div></div>
<p>❌ <strong>Missing Security Dimensions</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Bad - Pre-aggregation can&#x27;t be used with row-level security</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">dimensions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">product_type</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> order_status</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Result: Security filters force queries to hit raw data</span><br></span></code></pre></div></div>
<p>✅ <strong>Include Security Dimensions</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Good - Include dimensions used in query_rewrite filters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">dimensions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  product_type</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  order_status</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  customer_regions.name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># For regional filtering</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  customer_regions.region_key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># For regional security  </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  customers.customer_key        </span><span class="token comment" style="color:#999988;font-style:italic"># For sales rep security</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Result: All user types can hit the pre-aggregation cache</span><br></span></code></pre></div></div>
<p>❌ <strong>Non-Additive Measures Only</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Bad - These don&#x27;t aggregate well across different granularities</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">measures</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">average_order_value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> conversion_rate</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> distinct_customers</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Result: Pre-aggregation only useful for exact grain matches</span><br></span></code></pre></div></div>
<p>✅ <strong>Additive Building Blocks</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Good - Store components that can be aggregated and combined</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">measures</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  total_sales_amount</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Can sum across any dimension</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  order_count</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic"># Can sum across any dimension  </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  customer_count         </span><span class="token comment" style="color:#999988;font-style:italic"># Use count from customers cube instead of count_distinct</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Result: Pre-aggregation useful for many different queries</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="advanced-caching-concepts">Advanced Caching Concepts<a href="#advanced-caching-concepts" class="hash-link" aria-label="Direct link to Advanced Caching Concepts" title="Direct link to Advanced Caching Concepts">​</a></h2>
<p>While we won&#x27;t implement these in the workshop, Cube offers powerful advanced caching features:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="rollup-only-mode">Rollup-Only Mode<a href="#rollup-only-mode" class="hash-link" aria-label="Direct link to Rollup-Only Mode" title="Direct link to Rollup-Only Mode">​</a></h3>
<p>Force all queries to use pre-aggregations only:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CUBEJS_ROLLUP_ONLY=true</span><br></span></code></pre></div></div>
<p>Perfect for keeping your data warehouse &quot;asleep&quot; except during scheduled refreshes.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="custom-indexes">Custom Indexes<a href="#custom-indexes" class="hash-link" aria-label="Direct link to Custom Indexes" title="Direct link to Custom Indexes">​</a></h3>
<p>Optimize cache storage with strategic indexing:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">pre_aggregations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> optimized_sales</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">indexes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">dimensions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">region</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> customer_segment</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">dimensions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">ship_date</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="rollup-lambdas">Rollup Lambdas<a href="#rollup-lambdas" class="hash-link" aria-label="Direct link to Rollup Lambdas" title="Direct link to Rollup Lambdas">​</a></h3>
<p>Lambda pre-aggregations implement the <strong>Lambda architecture pattern</strong>, combining batch-processed historical data with real-time streaming data to provide a complete, up-to-date view of your metrics.</p>
<p><strong>The Concept:</strong>
Think of Lambda pre-aggregations as a smart union that combines:</p>
<ul>
<li><strong>Batch Layer</strong>: Pre-computed historical data (fast, complete)</li>
<li><strong>Speed Layer</strong>: Live streaming data (fresh, recent)</li>
<li><strong>Serving Layer</strong>: Cube seamlessly merges both for queries</li>
</ul>
<p><strong>Why Use Lambda Pre-Aggregations?</strong></p>
<ul>
<li><strong>Complete Data Coverage</strong>: Historical analysis + real-time insights</li>
<li><strong>Performance</strong>: Avoid expensive queries on massive historical datasets</li>
<li><strong>Freshness</strong>: Get the latest data without waiting for batch processing</li>
<li><strong>Scalability</strong>: Handle high-volume streaming data efficiently</li>
</ul>
<p><strong>Types Available:</strong></p>
<ol>
<li>
<p><strong>Batch + Source Data</strong>: Combines pre-aggregated historical data with live queries to your source database</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">pre_aggregations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sales_with_live_data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> rollup_lambda</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">union_with_source_data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">measures</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">total_sales_amount</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre></div></div>
</li>
<li>
<p><strong>Batch + Streaming Data</strong>: Merges pre-aggregated historical data with real-time streaming sources</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">pre_aggregations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> real_time_analytics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> rollup_lambda</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">streaming_data_source</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kafka_stream</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">measures</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">event_count</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> total_value</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre></div></div>
</li>
</ol>
<p><strong>Common Use Cases:</strong></p>
<ul>
<li><strong>E-commerce</strong>: Historical order data + live shopping cart events</li>
<li><strong>IoT Analytics</strong>: Archived sensor data + real-time device streams</li>
<li><strong>User Analytics</strong>: Historical user behavior + live clickstream data</li>
<li><strong>Financial Reporting</strong>: Daily batch reports + real-time transaction feeds</li>
</ul>
<p><img decoding="async" loading="lazy" alt="Batch and Source Data Lambda Pre-Aggregation" src="/cube-workshop/assets/images/rollup-lambda-7f7a47ce4eb39cb7ccba529244d143b1.png" width="2796" height="970" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="partitioning">Partitioning<a href="#partitioning" class="hash-link" aria-label="Direct link to Partitioning" title="Direct link to Partitioning">​</a></h3>
<p>Split large pre-aggregations across multiple date partitions to improve performance and mange incremental updates:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">pre_aggregations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> partitioned_sales</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">time_dimension</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ship_date</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">partition_granularity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> month</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Automatically creates monthly partitions for the ship_date dimension</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="orchestration">Orchestration<a href="#orchestration" class="hash-link" aria-label="Direct link to Orchestration" title="Direct link to Orchestration">​</a></h3>
<p>Cube can automatically orchestrate pre-aggregation builds using tools like Airflow, Dagster, or Prefect. This allows you to schedule and manage complex data workflows, ensuring your pre-aggregations are always up-to-date.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="key-takeaways">Key Takeaways<a href="#key-takeaways" class="hash-link" aria-label="Direct link to Key Takeaways" title="Direct link to Key Takeaways">​</a></h2>
<p>✅ <strong>Two-level caching</strong> - Automatic in-memory + configurable pre-aggregations<br>
<!-- -->✅ <strong>Additive measures</strong> - Design for cache-friendly aggregations<br>
<!-- -->✅ <strong>Security-aware</strong> - All caching respects access control rules<br>
<!-- -->✅ <strong>Background refresh</strong> - Data stays fresh without user impact<br>
<!-- -->✅ <strong>Extreme performance</strong> - Orders of magnitude faster than direct database queries</p>
<p>Caching transforms Cube from a query translator into a <strong>high-performance analytical engine</strong> that can handle massive datasets with millisecond response times.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="commit-your-caching-optimizations">Commit Your Caching Optimizations<a href="#commit-your-caching-optimizations" class="hash-link" aria-label="Direct link to Commit Your Caching Optimizations" title="Direct link to Commit Your Caching Optimizations">​</a></h2>
<p>Now that you&#x27;ve implemented sophisticated caching with pre-aggregations, let&#x27;s save your work:</p>
<p><strong>Step 1: Review Your Changes</strong></p>
<ol>
<li><strong>Ensure you&#x27;re in Development Mode</strong> - Look for the &quot;Dev Mode&quot; indicator</li>
<li><strong>Test your pre-aggregations</strong> one final time:<!-- -->
<ul>
<li>Verify the <code>sales_by_month</code> pre-aggregation is built and working</li>
<li>Check that the <code>executive_kpis</code> pre-aggregation serves executive queries</li>
<li>Confirm the <code>customer_behavior</code> pre-aggregation works with the new view</li>
<li>Test that cache indicators show queries hitting pre-aggregations</li>
</ul>
</li>
</ol>
<p><strong>Step 2: Commit Your Changes</strong></p>
<ol>
<li><strong>Navigate to the Data Model page</strong></li>
<li><strong>Review all your changes</strong> - You should see all modified files from the entire workshop: data modeling, access control, and caching changes</li>
<li><strong>Click &quot;Commit &amp; Sync&quot;</strong></li>
<li><strong>Add a descriptive commit message</strong>:<!-- -->
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Complete TPCH analytics platform implementation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Enhanced data model with business metrics and comprehensive sales view</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Implemented comprehensive access control (RLS, column masking, view visibility)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Added high-performance pre-aggregations for sub-second queries</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Production-ready semantic layer for analytics applications</span><br></span></code></pre></div></div>
</li>
<li><strong>Click &quot;Commit &amp; Sync&quot;</strong> to save all your workshop progress</li>
</ol>
<p><strong>Step 3: Deploy to Production</strong></p>
<ol>
<li><strong>Click the &quot;Merge&quot; button</strong> (same location as the Commit button)</li>
<li><strong>Enter a merge message</strong>:<!-- -->
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Deploy complete TPCH analytics platform</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ready for production use with React dashboard and other applications</span><br></span></code></pre></div></div>
</li>
<li><strong>Check &quot;Delete -dev- branch&quot;</strong> to clean up your development branch</li>
<li><strong>Click &quot;Merge&quot;</strong> to deploy to production</li>
</ol>
<p><strong>Step 4: Verify Production Deployment</strong></p>
<ol>
<li><strong>Wait for deployment</strong> - Check the deployment status indicator</li>
<li><strong>Test in Playground</strong> (now using production):<!-- -->
<ul>
<li>Run a few queries to ensure everything works correctly</li>
<li>Verify that your security contexts still function properly</li>
<li>Check that pre-aggregations are available in production</li>
</ul>
</li>
<li><strong>Note your production API endpoint</strong> - You&#x27;ll use this in the next section</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-youve-accomplished">What You&#x27;ve Accomplished<a href="#what-youve-accomplished" class="hash-link" aria-label="Direct link to What You&#x27;ve Accomplished" title="Direct link to What You&#x27;ve Accomplished">​</a></h3>
<p>🎉 <strong>Congratulations!</strong> You&#x27;ve successfully built and deployed a production-ready analytics platform:</p>
<p>✅ <strong>Comprehensive Data Model</strong> - Sales view with line item granularity and business context<br>
<!-- -->✅ <strong>Enterprise Security</strong> - Row-level security, column masking, and role-based access control<br>
<!-- -->✅ <strong>High-Performance Caching</strong> - Sub-second queries via optimized pre-aggregations<br>
<!-- -->✅ <strong>Production Deployment</strong> - Live, secure, and ready for real applications</p>
<p>Your data model is now ready for API consumption and application development!</p>
<hr>
<p><strong>Next</strong>: <a href="/cube-workshop/docs/apis">APIs →</a> - Learn how to consume your cached, secure data through multiple API interfaces.</p></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/cube-workshop/docs/access-control"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Access Control with Cube</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/cube-workshop/docs/apis"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">APIs: Multiple Ways to Access Data</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#why-caching-matters" class="table-of-contents__link toc-highlight">Why Caching Matters</a></li><li><a href="#cubes-two-level-caching-system" class="table-of-contents__link toc-highlight">Cube&#39;s Two-Level Caching System</a><ul><li><a href="#1-in-memory-cache-automatic" class="table-of-contents__link toc-highlight">1. In-Memory Cache (Automatic)</a></li><li><a href="#2-pre-aggregations-configurable" class="table-of-contents__link toc-highlight">2. Pre-Aggregations (Configurable)</a></li></ul></li><li><a href="#understanding-additive-vs-non-additive-measures" class="table-of-contents__link toc-highlight">Understanding Additive vs Non-Additive Measures</a><ul><li><a href="#-additive-measures-cache-friendly" class="table-of-contents__link toc-highlight">✅ Additive Measures (Cache-Friendly)</a></li><li><a href="#-non-additive-measures-cache-challenging" class="table-of-contents__link toc-highlight">❌ Non-Additive Measures (Cache-Challenging)</a></li><li><a href="#-making-non-additive-measures-cache-friendly" class="table-of-contents__link toc-highlight">💡 Making Non-Additive Measures Cache-Friendly</a></li></ul></li><li><a href="#pre-aggregations-in-action" class="table-of-contents__link toc-highlight">Pre-Aggregations in Action</a><ul><li><a href="#what-are-pre-aggregations" class="table-of-contents__link toc-highlight">What Are Pre-Aggregations?</a></li><li><a href="#exercise-1-basic-sales-pre-aggregation" class="table-of-contents__link toc-highlight">Exercise 1: Basic Sales Pre-Aggregation</a></li><li><a href="#exercise-2-executive-kpi-dashboard-pre-aggregation" class="table-of-contents__link toc-highlight">Exercise 2: Executive KPI Dashboard Pre-Aggregation</a></li><li><a href="#exercise-3-customer-behavior-pre-aggregation" class="table-of-contents__link toc-highlight">Exercise 3: Customer Behavior Pre-Aggregation</a></li></ul></li><li><a href="#understanding-your-pre-aggregation-strategy" class="table-of-contents__link toc-highlight">Understanding Your Pre-Aggregation Strategy</a></li><li><a href="#performance-optimization-strategies" class="table-of-contents__link toc-highlight">Performance Optimization Strategies</a><ul><li><a href="#1-granularity-matters" class="table-of-contents__link toc-highlight">1. Granularity Matters</a></li><li><a href="#2-dimension-selection" class="table-of-contents__link toc-highlight">2. Dimension Selection</a></li><li><a href="#3-measure-additivity" class="table-of-contents__link toc-highlight">3. Measure Additivity</a></li><li><a href="#4-refresh-strategy-based-on-business-needs" class="table-of-contents__link toc-highlight">4. Refresh Strategy Based on Business Needs</a></li><li><a href="#visual-performance-indicator" class="table-of-contents__link toc-highlight">Visual Performance Indicator</a></li></ul></li><li><a href="#building-and-monitoring-pre-aggregations" class="table-of-contents__link toc-highlight">Building and Monitoring Pre-Aggregations</a><ul><li><a href="#build-strategy" class="table-of-contents__link toc-highlight">Build Strategy</a></li><li><a href="#common-pitfalls-to-avoid" class="table-of-contents__link toc-highlight">Common Pitfalls to Avoid</a></li></ul></li><li><a href="#advanced-caching-concepts" class="table-of-contents__link toc-highlight">Advanced Caching Concepts</a><ul><li><a href="#rollup-only-mode" class="table-of-contents__link toc-highlight">Rollup-Only Mode</a></li><li><a href="#custom-indexes" class="table-of-contents__link toc-highlight">Custom Indexes</a></li><li><a href="#rollup-lambdas" class="table-of-contents__link toc-highlight">Rollup Lambdas</a></li><li><a href="#partitioning" class="table-of-contents__link toc-highlight">Partitioning</a></li><li><a href="#orchestration" class="table-of-contents__link toc-highlight">Orchestration</a></li></ul></li><li><a href="#key-takeaways" class="table-of-contents__link toc-highlight">Key Takeaways</a></li><li><a href="#commit-your-caching-optimizations" class="table-of-contents__link toc-highlight">Commit Your Caching Optimizations</a><ul><li><a href="#what-youve-accomplished" class="table-of-contents__link toc-highlight">What You&#39;ve Accomplished</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Workshop</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/cube-workshop/docs/intro">Getting Started</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Cube Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://cube.dev/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Documentation<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://slack.cube.dev/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/cube-js/cube" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://cube.dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cube.dev<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://cube.dev/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Cube Dev, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>